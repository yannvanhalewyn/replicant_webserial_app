{:tasks
 {;; CSS tasks
  css:build (shell "npx tailwindcss -i ./resources/css/main.css -o ./public/css/main.css")
  css:watch (shell "npx tailwindcss -i ./resources/css/main.css -o ./public/css/main.css --watch")

  ;; ClojureScript tasks
  cljs:dev (clojure "-M:cljs:dev:shadow-cljs" "watch" "app")
  cljs:build (clojure "-M:cljs:dev:shadow-cljs" "release" "app")
  cljs-repl (clojure "-M:cljs:dev:shadow-cljs" "cljs-repl" "app")

  ;; Combined tasks
  dev {:doc "Start dev server with CSS hot-reload"
       :requires ([babashka.process :as proc])
       :task (let [css-proc (proc/process ["npx" "tailwindcss" "-i" "./resources/css/main.css" "-o" "./public/css/main.css" "--watch"]
                                          {:inherit true})]
               (try
                 (clojure "-M:cljs:dev:shadow-cljs" "watch" "app")
                 (finally
                   (proc/destroy css-proc))))}

  build {:doc "Build production bundle"
         :task (do
                 (shell "npx tailwindcss -i ./resources/css/main.css -o ./public/css/main.css --minify")
                 (clojure "-M:cljs:dev:shadow-cljs" "release" "app"))}}}
